
{% load static %}
<html>
	<head>
		<title>Chat</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script>

        <link rel="stylesheet" href="{% static 'chat/css/messages.css' %}">
<script type="text/javascript">
    (function(d, m){
        var kommunicateSettings =
            {"appId":"213cad0785a6c10bbfbe3ec85afe9bf7f","popupWidget":true,"automaticChatOpenOnNavigation":true};
        var s = document.createElement("script"); s.type = "text/javascript"; s.async = true;
        s.src = "https://widget.kommunicate.io/v2/kommunicate.app";
        var h = document.getElementsByTagName("head")[0]; h.appendChild(s);
        window.kommunicate = m; m._globals = kommunicateSettings;
    })(document, window.kommunicate || {});
/* NOTE : Use web server to view HTML files as real-time update will not work if you directly open the HTML file in the browser. */
</script>
    </head>
	<!--Coded With Love By Mutiullah Samim-->
	<body>
    {% if user.is_authenticated %}
        <h1 style="text-align: end; padding-right: 10px">Logged in as : {{ request.session.UserName }}</h1>

    {% endif %}
		<div class="container-fluid h-100">
			<div class="row justify-content-center h-100 ">

				<div class="col-md-8 col-xl-6 chat h-100 mt-4">
					    <div class="card">

                                <div class="card-header msg_head">
                                    <div class="d-flex bd-highlight">
                                        <!--<div class="img_cont">-->

                                            <!--<span class="online_icon"></span>-->
                                        <!--</div>-->
                                        <div class="user_info">

                                                    <span>Chat with {{ request.session.ename }}</span>

                                        </div>

                                    </div>

                                </div>

                                <div class="card-body msg_card_body">
                                    <div id="send1">

                                    </div>

                                </div>
<div class="card-footer">
                                <form id="send-message-form">
                                    <div class="input-group">
                                        <div class="input-group-append">
                                            <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                                        </div>
                                        <input type="text" name="" id="textfield" class="form-control type_msg" placeholder="Type your message...">
                                        <div class="input-group-append">
                                            <button class="btn btn-secondary" type="button" id="button">
                                                <span class="input-group-text send_btn">
                                                    <i class="fas fa-location-arrow"></i>
                                                </span>
                                            </button>

                                        </div>
                                </div>
                                </form>
                            </div>
					        </div>




                    </div>
				</div>

			</div>
		</div>

        <script src="{% static 'js/messages.js' %}"></script>
<script src="/static/jquery.js"></script>
<script>

    function test() {



  $.ajax({
            url: "/Frontend/coun_msg",
            type: "GET",
            data: {


            },
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function(dat) {

                 var data=dat["data"];


             //////////////////

                $("#send1").text("");
				var len=data.length;
				for(var i=0;i<len;i++) {
                   var rid = data[i]['chat_id'];
                    var type = data[i]['s']
                    var mesg = data[i]['msg'];
                    var sendid = data[i]['date'];


                    if (type == "t" ) {
//                        $("#send1").append("<div align='center'><table id=tb1'' style='width:300px;'<tr border=0><td><div align='right'><div  class='container darker'><div>" + mesg + "</div></td></tr></table></div>")

                    $("#send1").append("<div class='d-flex justify-content-start mb-4'><div class=img_cont_msg'></div><div class='msg_cotainer'>"+mesg+"</div></div>")
                    }
                    else  {

//                        $("#send1").append("<div align='center'><table id=tb1'' style='width:300px;'<tr border=0><td><div align='left'><div><div class='container darker'>" + mesg + "</div></td></tr></table></div>")

                    $("#send1").append("<div class='d-flex justify-content-end mb-4'><div class='msg_cotainer_send'>"+mesg+"</div></div></div>")


                    }
                }


                /////////////////////////////////

            },
            error: function(ts) {
//{#                alert(ts);#}
            }
        });

    }


//<!--fnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnn-->



		$("#button").click(function()
		{

			var msg=$("#textfield").val();
			var senid=$("#rece").val();





  $.ajax({
            url: "/Frontend/coun_insert_chat/"+msg,
            type: "GET",
            data: {


            },
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function(dat) {

//{#                alert('success');#}
                $("#textfield").val("");

            },
            error: function(ts) {
//{#                alert(ts);#}
            }
        });


		});

function repeatEverySecond() {

//{#    alert('hiii');#}
  intervalID = setInterval(test, 1000);
}

	repeatEverySecond();


</script>
<script>


</script>
	</body>
</html>
